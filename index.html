<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>فحص الجهاز والمتصفح والشبكة</title>
    <style>
        body {
            font-family: "Tahoma", sans-serif;
            direction: rtl;
            background: #eef2f5;
            margin: 0;
            padding: 0;
        }

        header {
            background: #0078ff;
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 26px;
            font-weight: bold;
        }

        .container {
            width: 90%;
            margin: auto;
            padding: 20px 0;
        }

        .box {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: 0 0 10px #ccc;
        }

        h2 {
            margin-top: 0;
            color: #0078ff;
        }

        button {
            padding: 10px 20px;
            background: #0078ff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
        }

        button:hover {
            background: #005fcc;
        }

        .result {
            background: #f0f7ff;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            border-right: 4px solid #0078ff;
        }
    </style>
</head>
<body>

<header>فحص الجهاز والمتصفح والشبكة</header>

<div class="container">

    <!-- معلومات الجهاز -->
    <div class="box">
        <h2>معلومات الجهاز</h2>
        <div class="result" id="device"></div>
        <div class="result" id="screen"></div>
        <div class="result" id="battery"></div>
    </div>

    <!-- معلومات المتصفح -->
    <div class="box">
        <h2>معلومات المتصفح</h2>
        <div class="result" id="browser"></div>
        <div class="result" id="language"></div>
        <div class="result" id="webgl"></div>
    </div>

    <!-- معلومات الشبكة -->
    <div class="box">
        <h2>معلومات الشبكة</h2>
        <div class="result" id="ip"></div>
        <div class="result" id="connection"></div>
        <div class="result" id="downlink"></div>
    </div>

    <!-- اختبار السرعة -->
    <div class="box">
        <h2>اختبار سرعة الإنترنت</h2>
        <button onclick="testSpeed()">ابدأ الاختبار</button>
        <div class="result" id="speed"></div>
    </div>

    <!-- اختبار Ping -->
    <div class="box">
        <h2>اختبار Ping</h2>
        <button onclick="testPing()">ابدأ الاختبار</button>
        <div class="result" id="ping"></div>
    </div>

    <!-- اختبار Jitter -->
    <div class="box">
        <h2>اختبار Jitter</h2>
        <button onclick="testJitter()">ابدأ الاختبار</button>
        <div class="result" id="jitter"></div>
    </div>

</div>

<script>

// ----------------------
// معلومات الجهاز
// ----------------------
document.getElementById("device").innerHTML = "نوع الجهاز: " + navigator.userAgent;
document.getElementById("screen").innerHTML = "دقة الشاشة: " + window.screen.width + " × " + window.screen.height;

navigator.getBattery().then(battery => {
    document.getElementById("battery").innerHTML = "نسبة البطارية: " + (battery.level * 100).toFixed(0) + "%";
});

// ----------------------
// معلومات المتصفح
// ----------------------
document.getElementById("browser").innerHTML = "المتصفح: " + navigator.userAgent;
document.getElementById("language").innerHTML = "لغة الجهاز: " + navigator.language;

let canvas = document.createElement("canvas");
let gl = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
document.getElementById("webgl").innerHTML = "WebGL مدعوم: " + (gl ? "نعم" : "لا");

// ----------------------
// معلومات الشبكة
// ----------------------
let connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;

document.getElementById("connection").innerHTML = "نوع الاتصال: " + connection.effectiveType;
document.getElementById("downlink").innerHTML = "السرعة النظرية: " + connection.downlink + " Mbps";

// ----------------------
// جلب عنوان الـ IP
// ----------------------
fetch("https://api.ipify.org?format=json")
    .then(r => r.json())
    .then(d => {
        document.getElementById("ip").innerHTML = "عنوان الـ IP: " + d.ip;
    });

// ----------------------
// اختبار سرعة الإنترنت
// ----------------------
function testSpeed() {
    let fileUrl = "https://speed.hetzner.de/10MB.bin";
    let fileSize = 10 * 1024 * 1024;

    let start = performance.now();

    fetch(fileUrl)
        .then(() => {
            let end = performance.now();
            let duration = (end - start) / 1000;
            let speedMbps = (fileSize * 8) / (duration * 1024 * 1024);

            document.getElementById("speed").innerHTML =
                "سرعة التحميل: " + speedMbps.toFixed(2) + " Mbps";
        });
}

// ----------------------
// اختبار Ping
// ----------------------
function testPing() {
    let start = performance.now();

    fetch("https://www.google.com", { mode: "no-cors" })
        .then(() => {
            let end = performance.now();
            document.getElementById("ping").innerHTML =
                "Ping: " + Math.round(end - start) + " ms";
        });
}

// ----------------------
// اختبار Jitter
// ----------------------
function testJitter() {
    let pings = [];

    function singlePing() {
        let start = performance.now();
        return fetch("https://www.google.com", { mode: "no-cors" })
            .then(() => {
                let end = performance.now();
                pings.push(end - start);
            });
    }

    Promise.all([singlePing(), singlePing(), singlePing(), singlePing(), singlePing()])
        .then(() => {
            let diffs = [];
            for (let i = 1; i < pings.length; i++) {
                diffs.push(Math.abs(pings[i] - pings[i - 1]));
            }
            let jitter = diffs.reduce((a, b) => a + b) / diffs.length;

            document.getElementById("jitter").innerHTML =
                "Jitter: " + jitter.toFixed(2) + " ms";
        });
}

</script>

</body>
</html>
